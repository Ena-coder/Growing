### å¦‚æœä¸€ä¸ªalertå¯ä»¥è§£å†³çš„é—®é¢˜ï¼Œé‚£å°±è¯·è€ƒè™‘ä¸€ä¸‹å®šæ—¶å™¨çš„å»¶æ—¶åŠŸæ•ˆå§ï¼falseï¼Œ
> äº‹æƒ…æ˜¯è¿™æ ·çš„ğŸ˜¢ï¼š
> ![](https://user-gold-cdn.xitu.io/2020/5/21/17234f6eadf04455?w=436&h=931&f=png&s=152306)
> åœ¨iosä¸­ï¼ˆåœ¨å®‰å“ç³»ç»Ÿæ­£å¸¸ï¼‰è¿™ä¸ªloadingæ¡åˆ°æœ€åå°±ä¸€ç›´ä¸åŠ¨ï¼Œä¸€å¼€å§‹çŒœæƒ³æ˜¯ä¸æ˜¯æœ‰ä»€ä¹ˆå†…å®¹ä¸€ç›´æ²¡åŠ è½½å‡ºæ¥ã€‚
> å½“åœ¨çœŸæœºé‡ç°é—®é¢˜çš„æ—¶å€™å‘ç°ï¼Œå½“å†æ¬¡è¿›å…¥é¡µé¢æ—¶ï¼Œè¿›åº¦æ¡å°±èƒ½æ­£å¸¸åŠ è½½ï¼Ÿäºæ˜¯å¯¹æ¯”ç¬¬ä¸€æ¬¡è¿›å…¥é¡µé¢å’Œå†æ¬¡è¿›å…¥é¡µé¢è°ƒç”¨çš„æ¥å£æœ‰ä»€ä¹ˆä¸åŒï¼Œå‘ç°ç¬¬ä¸€æ¬¡è®¿é—®æ—¶æ¯”ç¬¬äºŒæ¬¡è®¿é—®æ—¶å¤šè°ƒç”¨äº†è¿™ä¸¤ä¸ªæ¥å£ğŸ¤”ï¼š
> ![](https://user-gold-cdn.xitu.io/2020/5/21/17234fa30e638e1a?w=859&h=286&f=png&s=67476)
1. /portal/wxqyhLoginCtrl/weixinLogin.do
2. /portal/weixin/weixinclientAction!handleOauthCode.action

>æ¥å£1æ˜¯æˆ‘ä»¬ä»£ç æœ‰çš„ï¼Œæ¥å£2æ˜¯å¾®ä¿¡è‡ªå¸¦çš„ï¼Œæˆ‘ä»¬çœ‹ä¸åˆ°ä»£ç ï¼Œæ‰€ä»¥æˆ‘ä»¬å°±å»çœ‹çœ‹æ¥å£1çš„ä»£ç ã€‚

>å‘ç°æ‹¿åˆ°æ¥å£getUserInfo.doè¿”å›çš„æ•°æ®responseåï¼Œå°±æ ¹æ®response.data.isLoginè¿›è¡Œåˆ¤æ–­ï¼Œä¸ºfalseåˆ™è°ƒç”¨æ¥å£weixinLogin.doå®ç°å½“å‰é¡µé¢æ‰“å¼€æŒ‡å®šURLé¡µé¢ï¼Œå¦‚æœä¸ºtrueï¼Œåˆ™è¿›å…¥elseåˆ†æ”¯...

>æ­£ç†ä¸åˆ°å¤´ç»ªçš„æ—¶å€™ï¼Œæœ¬æ¥æƒ³çœ‹çœ‹response.data.isLoginæ‰“å°å‡ºæ¥çš„æ˜¯ä¸æ˜¯`false`ï¼Œæ‰€ä»¥åŠ äº†ä¸€ä¸ªalert(response.data.isLogin)
```JavaScript
axios({
      method: 'post',
      url: baseURL + '/portal/wxqyhLoginCtrl/getUserInfo.do?corp_id=' + corp_id + '&agentCode=' + agentCode
    })//è°ƒç”¨æ¥å£getUserInfo.doè¿”å›çš„æ•°æ®responseä¸­çš„data.isLogin = false
      .then(function (response) {
        if (response.code == "0") {
            //åŠ äº†ä¸‹é¢è¿™å¥è¯ï¼Œçœ‹çœ‹response.data.isLoginæ‰“å°å‡ºæ¥çš„æ˜¯ä¸æ˜¯false
            alert(response.data.isLogin)
          if (response.data.isLogin == false) {
            window.location.href = baseURL + "/portal/wxqyhLoginCtrl/weixinLogin.do?corp_id=" + corp_id + '&agentCode=' + agentCode + '&pre=' + encodeURIComponent(window.location.hash);
          } else {
            window.location.href.indexOf("%")!=-1? history.replaceState(null,"",decodeURIComponent(window.location.href)):"";
            wxqyhConfig(response, resolve);
          }
        } else { //ç™»å½•æ¥å£è®¿é—®ä¸åˆ°
          window.location.href = '../module/error.html#/?msg=500NoResponse';
        }
      })
```
>ç»“æœç«Ÿå‘ç”Ÿäº†å¥‡è¿¹èˆ¬çš„ç°è±¡ğŸ¤”ï¼Œç¬¬ä¸€æ¬¡è®¿é—®çš„æ—¶å€™é¡µé¢å¼¹å‡ºäº†falseï¼Œå½“ç‚¹å‡»ç¡®å®šåé¡µé¢åˆèƒ½æ­£å¸¸åŠ è½½

>è¿™ä¸ªå¤§è½¬å˜ç»™äº†æˆ‘ä»¬ä¸€ä¸ªæ€è·¯
>åªè¦ç»™ä»–ä¸€ç‚¹æ—¶é—´ï¼Œå®ƒå°±èƒ½å†æ¬¡è®¿é—®ï¼Œå½“ç¬¬äºŒæ¬¡è®¿é—®å°±ä¸ä¼šåŠ è½½è¿™ä¸ªæ¥å£ï¼Œå°±èƒ½æ­£å¸¸æ˜¾ç¤ºã€‚
>åªè¦ç»™ä»–ä¸€ç‚¹æ—¶é—´ï¼Œåªè¦ä¸€ç‚¹æ—¶é—´å°±å¤Ÿäº†ã€‚äºæ˜¯æƒ³åˆ°åŠ ä¸€ä¸ªå®šæ—¶å™¨è®©å®ƒèƒ½å¤Ÿå»¶æ—¶setTimeout(() => {})
```
if (response.data.isLogin == false) {
    setTimeout(() => {
      window.location.href = baseURL + "/portal/wxqyhLoginCtrl/weixinLogin.do?corp_id=" + corp_id + '&agentCode=' + agentCode + '&pre=' + encodeURIComponent(window.location.hash) + '&_t=' + new Date().getTime();
    },500)
} 
```

### å¦‚ä½•å®‰è£…
[Charlesè¯ä¹¦è£…ä¸ä¸Š-android](https://www.jianshu.com/p/e60cd3c5cbb2)